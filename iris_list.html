{% load static %}

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Iris Listesi</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Glassmorphism table styling */
        th {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        td {
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        tr:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .btn-action {
            transition: all 0.3s ease;
            display: inline-block;
            text-decoration: none;
            font-weight: bold;
            border-radius: 5px;
        }
        .btn-action:hover {
            transform: translateY(-2px);
            filter: brightness(1.1);
        }
    </style>
</head>

<body style="
    margin: 0; 
    font-family: 'Segoe UI', sans-serif; 
    background-image: url('{% static "images/iris.jpg" %}');
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
">

    <div style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); z-index:-1;"></div>

    <nav style="background: rgba(44, 62, 80, 0.9); padding: 15px; display: flex; justify-content: space-around; backdrop-filter: blur(10px);">
        <a href="{% url 'home' %}" style="color: white; font-weight: bold; text-decoration: none;">üè† Ana Sayfa</a>
        <a href="{% url 'iris_list' %}" style="color: white; font-weight: bold; text-decoration: none; border-bottom: 2px solid #3498db;">üìä Veri Listesi</a>
        <a href="{% url 'predict' %}" style="color: white; font-weight: bold; text-decoration: none;">ü§ñ ML Tahmin</a>
        <form method="post" action="{% url 'logout' %}" style="display:inline; margin:0;">
            {% csrf_token %}
            <button type="submit" style="background:none; border:none; color:#ff7675; font-weight:bold; cursor:pointer; font-size:16px;">√áƒ±kƒ±≈ü Yap</button>
        </form>
    </nav>

    <div style="
        max-width: 1000px; 
        margin: 40px auto; 
        padding: 30px; 
        background: rgba(255, 255, 255, 0.1); 
        backdrop-filter: blur(15px); 
        -webkit-backdrop-filter: blur(15px);
        border-radius: 20px; 
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        color: white;
    ">

        <h2 style="text-shadow: 2px 2px 4px rgba(0,0,0,0.3); border-bottom: 2px solid rgba(52, 152, 219, 0.5); padding-bottom: 10px;">
            üå∏ Iris Veri Listesi
        </h2>

        <div style="margin-bottom: 25px;">
            <a href="{% url 'export_csv' %}" class="btn-action" style="background: #3498db; color: white; padding: 10px 18px;">üì• CSV ƒ∞ndir</a>
            <a href="{% url 'import_csv' %}" class="btn-action" style="background: #9b59b6; color: white; padding: 10px 18px; margin-left: 10px;">üì§ CSV Y√ºkle</a>
        </div>

        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; margin-bottom: 25px;">
                <thead>
                    <tr>
                        <th style="padding: 15px; border: 1px solid rgba(255,255,255,0.2);">T√ºr</th>
                        <th style="padding: 15px; border: 1px solid rgba(255,255,255,0.2);">Sepal Boyu (cm)</th>
                        <th style="padding: 15px; border: 1px solid rgba(255,255,255,0.2);">Bah√ße</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in items %}
                    <tr>
                        <td style="padding: 12px; text-align: center;">{{ item.species }}</td>
                        <td style="padding: 12px; text-align: center;">{{ item.sepal_length }}</td>
                        <td style="padding: 12px; text-align: center;">{{ item.garden.name }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3" style="padding: 30px; text-align: center; color: rgba(255,255,255,0.6);">Hen√ºz veri eklenmedi.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div style="background: rgba(255, 202, 40, 0.2); padding: 15px; border-radius: 12px; border-left: 5px solid #ffca28; margin-bottom: 25px;">
            <strong style="color: #ffca28;">üìä Veri √ñzeti</strong>
            <p style="margin: 5px 0 0 0;">Toplam g√∂zlem sayƒ±sƒ±: <strong>{{ total_count }}</strong></p>
        </div>

        <div style="margin-bottom: 40px;">
            <a href="{% url 'iris_create' %}" style="color: #2ecc71; font-weight: bold; text-decoration: none; font-size: 1.1em;">
                ‚ûï Yeni Veri Ekle
            </a>
        </div>

        <hr style="border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin-bottom: 40px;">

        {% if last_item %}
        <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px;">
            <h3 style="text-align: center; margin-top: 0;">üìà Son Eklenen Veri Analizi ({{ last_item.species }})</h3>
            <div style="max-width: 600px; margin: auto;">
                <canvas id="irisChart"></canvas>
            </div>
        </div>

        <script>
            const ctx = document.getElementById('irisChart').getContext('2d');
            // Setting global font color for Chart to white
            Chart.defaults.color = '#ffffff';

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Sepal Uzunluk', 'Sepal Geni≈ülik', 'Petal Uzunluk', 'Petal Geni≈ülik'],
                    datasets: [{
                        label: 'Boyutlar (cm)',
                        data: [
                            {{ last_item.sepal_length }},
                            {{ last_item.sepal_width }},
                            {{ last_item.petal_length }},
                            {{ last_item.petal_width }}
                        ],
                        backgroundColor: [
                            'rgba(52, 152, 219, 0.8)',
                            'rgba(46, 204, 113, 0.8)',
                            'rgba(155, 89, 182, 0.8)',
                            'rgba(241, 196, 15, 0.8)'
                        ],
                        borderColor: 'rgba(255,255,255,0.5)',
                        borderWidth: 1
                    }]
                },
                options: {
                    plugins: {
                        legend: { labels: { color: 'white' } }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true,
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: 'white' }
                        },
                        x: {
                            ticks: { color: 'white' }
                        }
                    }
                }
            });
        </script>
        {% endif %}
    </div>

</body>
</html>